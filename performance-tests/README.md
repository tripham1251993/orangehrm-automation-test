# OrangeHRM Performance Tests

This directory contains performance tests for the OrangeHRM application using k6, a modern load testing tool.

## Directory Structure

```
performance-tests/
├── k6-results.json       # Results file generated by k6 runs
├── package.json          # NPM package configuration
├── performance.js        # Main k6 test script
└── README.md             # This documentation file
```

## Installation Guide

### Prerequisites
- Node.js (LTS version)
- k6

### Installing k6

#### On Ubuntu (used in CI):
```bash
sudo gpg -k || sudo apt install gnupg -y
curl -s https://dl.k6.io/key.gpg | sudo gpg --dearmor -o /usr/share/keyrings/k6-archive-keyring.gpg
echo "deb [signed-by=/usr/share/keyrings/k6-archive-keyring.gpg] https://dl.k6.io/deb stable main" | sudo tee /etc/apt/sources.list.d/k6.list
sudo apt update
sudo apt install k6 -y
```

#### On macOS:
```bash
brew install k6
```

#### On Windows:
```bash
choco install k6
```
Or download the installer from [k6 website](https://k6.io/docs/get-started/installation/).

## Running Performance Tests

### Locally
```bash
# Navigate to performance-tests directory
cd performance-tests

# Run the performance tests locally with HTTP debug
npm run test:performance
# Or directly with k6
k6 run --out json=./k6-results.json --http-debug=full performance.js
```

### In CI
The tests are configured to run automatically in GitHub Actions when:
- Changes are pushed to main/master branch in the `performance-tests/` directory
- Changes are made to the CI workflow file
- Manually triggered via GitHub Actions

To run in CI environment:
```bash
npm run test:performance:ci
```

## Scenario Configuration

The performance tests use k6's scenario feature to define the load patterns:

```javascript
export const options = {
  scenarios: {
    user_login_load: {
      executor: 'ramping-arrival-rate',  // Controls how load is generated
      startRate: 1,                      // Starting iterations per second
      timeUnit: '1s',                    // Time unit for the rate
      preAllocatedVUs: 5,                // Pre-allocate virtual users
      maxVUs: 5,                         // Maximum number of virtual users
      stages: [
        { duration: '5s', target: 5 },   // Ramp up to 5 iterations/s over 5s
        // Additional stages can be uncommented for longer test runs:
        // { duration: '1m', target: 10 },  // Ramp up to 10 iterations/s over 1m
        // { duration: '30s', target: 20 }, // Ramp up to 20 iterations/s over 30s
        // { duration: '1m', target: 20 },  // Stay at 20 iterations/s for 1m
        // { duration: '30s', target: 5 },  // Ramp down to 5 iterations/s over 30s
        // { duration: '30s', target: 0 },  // Ramp down to 0 iterations/s over 30s
      ],
    },
  },
}
```

### Key Parameters:

- **executor**: Determines how the load is generated. 'ramping-arrival-rate' generates a specified number of iterations started in a specified period of time.
- **startRate**: The number of iterations to start per time unit at the beginning.
- **timeUnit**: The time unit for the rate ('1s' means per second).
- **preAllocatedVUs**: The number of VUs (Virtual Users) to pre-allocate before the test starts.
- **maxVUs**: Maximum number of VUs that can be allocated during the test.
- **stages**: Array of objects that define the target number of iterations per second and the duration it takes to reach that target.

## Metrics and Results

The tests check for:
- Login status code (expected: 302 redirect)
- Response time is less than 1000ms
- Response duration is less than 1500ms

Results are stored in `k6-results.json` after each test run and are also uploaded as artifacts in CI runs.

## Customizing Tests

To adjust the load patterns, modify the `stages` array in `performance.js`. For more complex scenarios, you can add additional scenarios to the `options.scenarios` object.

For more information on k6 configuration, refer to the [k6 documentation](https://k6.io/docs/).